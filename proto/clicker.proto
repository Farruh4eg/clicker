syntax = "proto3";

package clicker;

option go_package = "clicker/gen/proto";

service GameService {
  rpc PlayGame(stream ClientToServer) returns (stream ServerToClient);
}

message Player {
  string id = 1;
  string name = 2;
  double attack_damage = 3;
  int64 level = 4;
}

message Enemy {
  string id = 1;
  string name = 2;
  double max_hp = 3;
  double current_hp = 4;
  int64 level = 5;
  optional bytes image = 6;
}

message ClientToServer {
  optional Player self_info = 1;

  oneof event {
    AttackAction attack = 2;
  }
}

message AttackAction {
  // TODO: maybe something additional?
}

message ServerToClient {
  oneof event {
    InitialState initial_state = 1;
    GameStateUpdate game_state_update = 2;
    NewEnemySpawned enemy_spawned = 5;
  }

  PlayerJoined player_joined = 3;
  PlayerLeft player_left = 4;
}

message InitialState {
  Enemy enemy = 1;
  repeated Player players = 2;
}

message GameStateUpdate {
  string enemy_id = 1;
  double enemy_current_hp = 2;
  optional HitInfo last_hit = 3;
}

message NewEnemySpawned {
  Enemy enemy = 1;
}

message HitInfo {
  string attacker_id = 1;
  double damage_dealt = 2;
}

message PlayerJoined {
  Player player = 1;
}

message PlayerLeft {
  string player_id = 1;
}
