syntax = "proto3";

package clicker;

option go_package = "clicker/gen/proto";

service GameService {
  rpc PlayGame(stream ClientToServer) returns (stream ServerToClient);
}

message Player {
  string id = 1;
  string name = 2;

  PlayerStats stats = 3;

  PlayerResources resources = 4;

  PlayerEquipment equipment = 5;

  // repeated Item inventory = 6;
}

message PlayerStats {
  int64 level = 1;
  int64 experience = 2;
  int64 next_level_exp = 3;
}

message PlayerResources {
  int64 gold = 1;
}

message PlayerEquipment {
  Weapon weapon = 1;
}

message Weapon {
  string item_id = 1;
  string name = 2;
  int64 level = 3;
  float base_damage = 4;
  float damage_growth = 5;
}

message Enemy {
  string id = 1;
  string name = 2;
  double max_hp = 3;
  double current_hp = 4;
  int64 level = 5;
  optional bytes image = 6;
}

message ClientToServer {
  optional Player self_info = 1;

  oneof event {
    AttackAction attack = 2;
  }
}

message AttackAction {
  // TODO: maybe something additional?
}

message ServerToClient {
  oneof event {
    InitialState initial_state = 1;
    GameStateUpdate game_state_update = 2;
    NewEnemySpawned enemy_spawned = 3;
    PlayerStateUpdate player_state_update = 4;
  }

  PlayerJoined player_joined = 5;
  PlayerLeft player_left = 6;
}

message PlayerStateUpdate {
  Player player = 1;
}

message InitialState {
  Enemy enemy = 1;
  repeated Player players = 2;
}

message GameStateUpdate {
  string enemy_id = 1;
  double enemy_current_hp = 2;
  optional HitInfo last_hit = 3;
}

message NewEnemySpawned {
  Enemy enemy = 1;
}

message HitInfo {
  string attacker_id = 1;
  double damage_dealt = 2;
}

message PlayerJoined {
  Player player = 1;
}

message PlayerLeft {
  string player_id = 1;
}
